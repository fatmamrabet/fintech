name: CD Transition

# D√©clenche le workflow sur tout push vers develop ou main (apr√®s merge)
on:
  push:
    branches:
      - develop
      - main

jobs:
  cd:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Se connecter √† Jira
      - name: Login to Jira
        uses: atlassian/gajira-login@v3
        env:
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_USER_EMAIL: ${{ secrets.JIRA_EMAIL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}

      # 2Ô∏è‚É£ D√©terminer la transition selon la branche
      - name: Decide Jira transition
        run: |
          if [[ "${{ github.ref_name }}" == "develop" ]]; then
            echo "TRANSITION=Done" >> $GITHUB_ENV
          else
            echo "TRANSITION=Released" >> $GITHUB_ENV

      # 3Ô∏è‚É£ D√©placer le ticket Jira automatiquement
      - name: Move Jira ticket
        uses: atlassian/gajira-transition@v3
        with:
          issue: FNC-3
          transition: ${{ env.TRANSITION }}

      # 4Ô∏è‚É£ Simuler le d√©ploiement
      - name: Deploy
        run: echo "üöÄ Deploying artifact..."
