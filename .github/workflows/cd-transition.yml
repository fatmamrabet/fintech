name: CD Transition

on:
  push:
    branches:
      - develop
      - main
      - feature/FNC-3-init-ci
  workflow_dispatch:

jobs:
  cd:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Login to Jira
        uses: atlassian/gajira-login@v3
        env:
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}

      - name: Decide Jira transition
        run: |
          if [[ "${{ github.ref_name }}" == "develop" ]]; then
            echo "TRANSITION=Done" >> $GITHUB_ENV
          else
            echo "TRANSITION=Released" >> $GITHUB_ENV
          fi

      - name: Move Jira ticket
        uses: atlassian/gajira-transition@v3
        with:
          issue: FNC-3
          transition: ${{ env.TRANSITION }}

      - name: Deploy
        run: echo "ðŸš€ Deploying artifact..."
